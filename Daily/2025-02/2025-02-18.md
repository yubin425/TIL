## ë‚ ì§œ: 2025-02-18

### ìŠ¤í¬ëŸ¼
- ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµí•˜ë©° ë³µìŠµí•˜ê¸°

### ìƒˆë¡œ ë°°ìš´ ë‚´ìš©
### Kubernets ì‹¤ìŠµ 

#### (1) podì˜ ìƒì„± ë°©ë²•
    
    ```bash
    #ì²«ë²ˆì§¸ ìƒì„±ë²• - kubectl runì„ í™œìš©í•œ ìƒì„±
    kubectl run mynginx1 --image nginx #podë¥¼ ë§Œë“¤ê³ 
    pod/mynginx1 created
    kubectl get pods #ì¡°íšŒí•œë‹¤
    NAME       READY   STATUS              RESTARTS   AGE
    mynginx1   0/1     ContainerCreating   0          8s
    kubectl delete pod mynginx1 #podë¥¼ ì§€ìš´ë‹¤
    pod "mynginx1" deleted
    
    ```
    
    ```bash
    #ë‘ë²ˆì§¸ ìƒì„±ë²• - manifestë¥¼ ì´ìš©í•œ í¬ë“œ ìƒì„±
    cat mynginx.yaml
    apiVersion: v1 #ì¿ ë²„ë„¤í‹°ìŠ¤ apiì˜ ë²„ì „ì„ ë‚˜íƒ€ëƒ„
    kind: Pod #ì–´ë–¤ ì¢…ë¥˜ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ì˜í• ì§€
    metadata: #name,label,annotations ë“±ì˜ ë©”íƒ€ë°ì´í„° ì •ì˜
      labels: #ë¼ë²¨ ì¶”ê°€
        run: mynginx #run: mynginxë¼ëŠ” ë¼ë²¨ì„ ì¶”ê°€í•œë‹¤.
      name: mynginx #íŒŒë“œì˜ ì´ë¦„ì€ mynginx
    spec:#ë¦¬ì†ŒìŠ¤ ì‚¬ì–‘ì„ ì •ì˜
      containers: #íŒŒë“œì— í¬í•¨ë  ì»¨í…Œì´ë„ˆ ì •ì˜
        - image: nginx #nginx ì´ë¯¸ì§€ë¥¼ ê°€ì§„ ì»¨í…Œì´ë„ˆ
          name: mynginx #ì»¨í…Œì´ë„ˆì˜ ì´ë¦„ì€ mynginx
     
     **kubectl apply -f mynginx.yaml**
    pod/mynginx created
     kubectl get pods
    NAME      READY   STATUS    RESTARTS   AGE
    mynginx   1/1     Running   0          8s
    **kubectl describe pod mynginx** #ìƒì„¸ ì •ë³´ë¥¼ ë³¼ ìˆ˜ë„ ìˆë‹¤. 
          
    ```
    
    ```bash
    #ì„¸ë²ˆì§¸ ìƒì„±ë²• - manifest ìë™ ìƒì„±
    kubectl run mynginx3 --image=nginx --dry-run=client -o yaml > mynginx3.yaml
    #--dry-run=client: ëª…ë ¹ì–´ê°€ ì‹¤í–‰í•  ê²°ê³¼ê°€ ì–´ë–»ê²Œ ì¶œë ¥ë ì§€ í™•ì¸í•˜ê²Œ í•´ì£¼ëŠ” ì˜µì…˜
    #-o yaml: ì¶œë ¥ í˜•ì‹ì„ YAMLë¡œ ì§€ì •
    
    #ë‹¤ìŒê³¼ ê°™ì€ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤!
    cat mynginx3.yaml 
    apiVersion: v1
    kind: Pod
    metadata:
      creationTimestamp: null
      labels:
        run: mynginx3
      name: mynginx3
    spec:
      containers:
      - image: nginx
        name: mynginx3
        resources: {}
      dnsPolicy: ClusterFirst
      restartPolicy: Always
    status: {}
    
     **kubectl get pods -A #ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ pod ì •ë³´ ì¡°íšŒ**
    NAMESPACE     NAME                               READY   STATUS              RESTARTS      AGE
    default       mynginx3                           0/1     ContainerCreating   0             3s
    kube-system   coredns-668d6bf9bc-gd6f6           1/1     Running             1 (26h ago)   26h
    kube-system   etcd-minikube                      1/1     Running             1 (26h ago)   26h
    kube-system   kube-apiserver-minikube            1/1     Running             1 (29m ago)   26h
    kube-system   kube-controller-manager-minikube   1/1     Running             1 (26h ago)   26h
    kube-system   kube-proxy-jhf9x                   1/1     Running             1 (26h ago)   26h
    kube-system   kube-scheduler-minikube            1/1     Running             1 (26h ago)   26h
    kube-system   storage-provisioner                1/1     Running             3 (27m ago)   26h
    ```
    
#### (2) í¬ë“œ ê´€ë¦¬
    
     `kubectl logs -f mynginx3` ë¥¼ ì‚¬ìš©í•´ ë¡œê·¸ë¥¼ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
    
    `-f` : ë¡œê·¸ ë‚´ìš©ì„ ìŠ¤íŠ¸ë¦¼(ì§€ì†ì ìœ¼ë¡œ)ìœ¼ë¡œ ì¶œë ¥ 
    
    `--previous` : ì»¨í…Œì´ë„ˆ ì´ì „ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¡œê·¸ë¥¼ ì¶œë ¥(ì¬ì‹œì‘ë˜ê¸° ì „ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ, ê³„ì† ì¬ì‹œì‘ í•˜ëŠ” ê²½ìš°ì— ìœ ìš©í•¨)
    
    `kubectl delete -f mynginx3.yaml` ì´ëŸ° ì‹ìœ¼ë¡œ yaml íŒŒì¼ ëª…ì‹œë¡œ ì‚­ì œë„ ê°€ëŠ¥í•˜ë‹¤.
    
#### (3) ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤
    
    ```bash
    **#hello-worldë¥¼ ì‹¤í–‰ì‹œì¼œë³´ì
    kubectl cluster-info #í˜„ì¬ cluterì˜ infoë¥¼ ì¶œë ¥**
    #api ì„œë²„(ëª¨ë“ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ì™€ ìƒí˜¸ì‘ìš©ì„ ì²˜ë¦¬í•˜ëŠ”, í•µì‹¬ê´€ë¦¬ì„œë²„) url
    #kubectl ëª…ë ¹ì–´ë¥¼ í†µí•´ ê°„ì ‘ ì ‘ì† ê°€ëŠ¥í•˜ë©°, ì´ urlì„ í†µí•´ ë¦¬ì†ŒìŠ¤ ì œì–´&ê´€ë¦¬ê°€ ì´ë£¨ì–´ì§
    Kubernetes control plane is running at https://ip:port
    
    # íŒŒë“œ ê°„ í†µì‹ ì‹œ ì‚¬ìš©ë˜ëŠ” dns ì„œë¹„ìŠ¤ë¥¼ ì œê³µ
    # íŒŒë“œë‚˜ ì„œë¹„ìŠ¤ ì´ë¦„ì„ ip ì£¼ì†Œë¡œ ë³€í™˜
    CoreDNS is running at https://ip:port/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
    
    **kubectl get node #í´ëŸ¬ìŠ¤í„°ì˜ ë…¸ë“œ ëª©ë¡ ì¶œë ¥**
    NAME       STATUS   ROLES           AGE   VERSION
    minikube   Ready    control-plane   27h   v1.32.0
    
    # hello-worldë¥¼ ì‚¬ìš©í•´ podë¥¼ ì‹¤í–‰í•˜ëŠ” ëª…ë ¹
    **kubectl run hello-world --image=hello-world -it --restart=Never**
    # -it: ì¸í„°ë™í‹°ë¸Œ(ìƒí˜¸ì‘ìš© ê°€ëŠ¥) ëª¨ë“œë¡œ ì‹¤í–‰í•œë‹¤. -iëŠ” í‘œì¤€ ì…ë ¥ì„ í™œì„±í™”í•˜ê³ , -tëŠ” í„°ë¯¸ë„ì„ í• ë‹¹í•œë‹¤.
    # --restart=Never: íŒŒë“œê°€ ì¢…ë£Œëœ í›„ ìë™ìœ¼ë¡œ ì¬ì‹œì‘í•˜ì§€ ì•Šë„ë¡ ì„¤ì •í•œë‹¤. 
    
    ```
    
#### (4) ë””í”Œë¡œì´ë¨¼íŠ¸, ë ˆí”Œë¦¬ì¹´ì…‹
    
    ```bash
    **kubectl run hello-world --image=hello-world --restart=Never**
    pod/hello-world created
    **kubectl logs hello-world #ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ì‹œí‚¤ê³  ë¡œê·¸ë¥¼ ë‚¨ê²¼ë‹¤.** 
    
    **kubectl create deployment --image hello-world hello-world
    # "hello-world"ë¼ëŠ” deploymentë¥¼ ìƒì„±í•œë‹¤.
    # Deployment: ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê³  ê´€ë¦¬í•˜ëŠ” Kubernetes ë¦¬ì†ŒìŠ¤
    # ë ˆí”Œë¦¬ì¹´ì…‹ê³¼ í•¨ê»˜ íŒŒë“œë¥¼ ê´€ë¦¬í•œë‹¤. ì´ë¯¸ì§€ ë²„ì „, íŒŒë“œì˜ ê°œìˆ˜ ë“±ì„ ëª©í‘œ ìƒíƒœê°€ ë˜ë„ë¡ ê´€ë¦¬í•˜ëŠ” ì—­í• **
    deployment.apps/hello-world created
    **kubectl get all #í˜„ì¬ Kubernetes í´ëŸ¬ìŠ¤í„° ë‚´ì— ìˆëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°íšŒ**
    NAME                               READY   STATUS      RESTARTS   AGE
    pod/hello-world                    0/1     Completed   0          2m33s
    **#ë ˆí”Œë¦¬ì¹´ì…‹ ì˜¤ë¸Œì íŠ¸ ì´ë¦„ ë’¤ì— ì¶”ê°€ì  í•´ì‹œ ë¬¸ìì—´ì´ ì¶”ê°€, ìœ ì¼í•œ ì´ë¦„ì„ ë¶€ì—¬ ë°›ìŒ**
    pod/hello-world-7f9cf8cc4d-lx64g   0/1     Completed   0          7s
    
    # pod/hello-world-7f9cf8cc4d-lx64gëŠ” ì‹¤íŒ¨í•œ ê²½ìš° ìë™ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±ë  ìˆ˜ ìˆìœ¼ë©°, 
    #Deploymentì™€ ReplicaSetì˜ ê´€ë¦¬ í•˜ì— ìˆìŒ
    #ë°˜ë©´ pod/hello-worldëŠ” ì¢…ë£Œ í›„ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ì§€ ì•ŠìŒ
    
    NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
    service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   27h
    
    NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/hello-world   0/1     1            0           7s
    
    **#ë””í”Œë¡œì´ë¨¼íŠ¸ ì˜¤ë¸Œì íŠ¸ ì´ë¦„ ë’¤ì— í•´ì‹œ ë¬¸ìì—´ì´ ë¶™ì€ ëª¨ì–‘ìƒˆ
    #ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ í•¨ê»˜ íŒŒë“œ ìˆ˜ê°€ ì§€ì •í•œ ê°œìˆ˜ê°€ ë˜ë„ë¡ ì œì–´**
    NAME                                     DESIRED   CURRENT   READY   AGE
    replicaset.apps/hello-world-7f9cf8cc4d   1         1         0       7s
    
    #íŒŒë“œ ìƒíƒœ í™•ì¸
    **kubectl get deploy,po #Deploymentì™€ Podì— ëŒ€í•œ ìƒíƒœë¥¼ í™•ì¸**
    NAME                          READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/hello-world   **0/1**     1            0           11m
    
    #ë ˆí”Œë¦¬ì¹´ì…‹ì˜ íŒŒë“œê°€ ê³„ì† ì¬ì‹œì‘ì¤‘
    NAME                               READY   STATUS             RESTARTS       AGE
    pod/hello-world                    0/1     Completed          0              13m
    pod/hello-world-7f9cf8cc4d-lx64g   0/1     **CrashLoopBackOff**   6 (5m2s ago)   11m
    ```
    
#### (5) ë””í”Œë¡œì´ë¨¼íŠ¸ í™•ì¥
    
    ```bash
    **kubectl create deployment webserver --image=nginx**
    deployment.apps/webserver created
    **kubectl get deploy,po**
    NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webserver   0/1     1            0           2s
    
    NAME                             READY   STATUS              RESTARTS   AGE
    pod/hello-world                  0/1     Completed           0          27m
    pod/webserver-765f5759d4-tzpbs   0/1     ContainerCreating   0          2s
    
    #í™•ì¥í•˜ë©´ í™•ì¥í•œ ë§Œí¼ ëŠ˜ì–´ë‚œê±¸ ë³¼ ìˆ˜ ìˆë‹¤.
    **kubectl scale deployment webserver --replicas=5**
    deployment.apps/webserver scaled
    **kubectl get deploy,po**
    NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webserver   1/5     5            1           9s
    
    NAME                             READY   STATUS              RESTARTS   AGE
    pod/hello-world                  0/1     Completed           0          27m
    pod/webserver-765f5759d4-9w7lv   0/1     ContainerCreating   0          2s
    pod/webserver-765f5759d4-k6d6t   0/1     ContainerCreating   0          2s
    pod/webserver-765f5759d4-n46l9   0/1     ContainerCreating   0          2s
    pod/webserver-765f5759d4-tzpbs   1/1     Running             0          9s
    pod/webserver-765f5759d4-xdbr4   0/1     ContainerCreating   0          2s
    
    #ë‘ê°œë§Œ ì§€ì›Œë³¸ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ?
    kubectl delete pod webserver-765f5759d4-9w7lv webserver-765f5759d4-k6d6t
    #ë‹¹ì—°íˆ ìƒˆë¡œìš´ íŒŒë“œê°€ ë‹¤ì‹œ ìƒê¸°ê³ , ìë¦¬ë¥¼ ì±„ìš´ë‹¤. deploymentê°€ ê´€ë¦¬ì¤‘ì´ê¸° ë•Œë¬¸
    kubectl get deploy,po
    NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
    deployment.apps/webserver   5/5     5            5           3m34s
    
    NAME                             READY   STATUS      RESTARTS   AGE
    pod/hello-world                  0/1     Completed   0          30m
    pod/webserver-765f5759d4-n46l9   1/1     Running     0          3m27s
    pod/webserver-765f5759d4-n4h54   1/1     Running     0          6s
    pod/webserver-765f5759d4-tzpbs   1/1     Running     0          3m34s
    pod/webserver-765f5759d4-v6dvl   1/1     Running     0          6s
    pod/webserver-765f5759d4-xdbr4   1/1     Running     0          3m27s
    ```
    
#### (6) job controller
    
    job :  íŠ¹ì • ì‘ì—…ì„ ì™„ë£Œí•˜ëŠ”ë° í•„ìš”í•œ podë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤. ëŒ€ê°œ ë°°ì¹˜ ì‘ì—… ë“±. 
    
    podë¥¼ ìƒì„±í•´ ëª…ì‹œì  ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , ì™„ë£Œë˜ë©´ podë¥¼ ì¢…ë£Œì‹œí‚¨ë‹¤. Kubernetes Jobì€ ì‹¤íŒ¨í•œ ì‘ì—…ì„ ì¬ì‹œë„í•˜ì—¬ **ìµœì¢…ì ìœ¼ë¡œ ì‘ì—…ì´ ì„±ê³µí•˜ë„ë¡ ë³´ì¥í•˜ë¯€ë¡œ, job2ëŠ” í•œ ë²ˆ ë” ì‹¤í–‰ë˜ì—ˆë‹¤.**
    
    **`onFailure`** ì˜µì…˜ì€ Jobì´ë‚˜ CronJobì—ì„œ **Podì˜ ì‹¤í–‰ì´ ì‹¤íŒ¨í–ˆì„ ë•Œ íŠ¹ì • ì‘ì—…ì„ ì§€ì •í•˜ëŠ” ì˜µì…˜ì´ë‹¤.** 
    
    ```bash
    **kubectl create job job-1 --image=ubuntu -- /bin/bash -c "exit 0"
    kubectl create job job-2 --image=ubuntu -- /bin/bash -c "exit 1"
    #ê°ê° exit0(ì •ìƒì¢…ë£Œ) / exit1(ì˜¤ë¥˜ ë°œìƒ) ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ëŠ” jobì„ ìƒì„±í•¨**
    
    **kubectl get jobs** 
    NAME    STATUS     COMPLETIONS   DURATION   AGE
    job-1   Complete   1/1           12s        21s
    job-2   Running    0/1           9s         9s
    **kubectl get pod**
    NAME          READY   STATUS      RESTARTS   AGE
    hello-world   0/1     Completed   0          36m
    job-1-7lc7h   0/1     Completed   0          30s
    job-2-8bk2z   0/1     Error       0          18s
    job-2-f2xx4   0/1     Error       0          5s
    
    kubectl delete jobs job-1 job-2
    
    #ê´€ë ¨í•œ ì˜µì…˜
    spec:
      restartPolicy: OnFailure  # ì‹¤íŒ¨í•œ ê²½ìš°ì—ë§Œ ì¬ì‹œë„
    Backoff Limit:    6 #6ë²ˆê¹Œì§€ë§Œ ì‹œë„
    ```
    
#### (7) ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì™€ íŒŒë“œ, í´ëŸ¬ìŠ¤í„° ë„¤íŠ¸ì›Œí¬
    
    ```bash
    kubectl get pod hello-world -o wide
    NAME          READY   STATUS      RESTARTS   AGE   IP            NODE       NOMINATED NODE   READINESS GATES
    hello-world   0/1     Completed   0          56m   10.244.0.12   minikube   <none>           <none>
    
    #urlì„ ì‚¬ìš©í•˜ì—¬ http://10.244.0.12 ì£¼ì†Œë¡œ HTTP ìš”ì²­
    #-m 3: ìš”ì²­ì„ ìµœëŒ€ 3ì´ˆê°„ ê¸°ë‹¤ë¦¬ë„ë¡ ì„¤ì •
    #podì˜ ë‚´ë¶€ ipë¡œ ìš”ì²­ì„ ë³´ëƒˆì§€ë§Œ, ì‘ë‹µì€ ì—†ë‹¤. ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ì•ˆë˜ê¸° ë•Œë¬¸.
    curl -m 3 http://10.244.0.12
    curl: (28) Connection timed out after 3002 milliseconds
    
    #nginx podë¥¼ ì˜¬ë ¤ì„œ, busybox pod(ì»¨í…Œì´ë„ˆ)ìœ¼ë¡œ ì ‘ê·¼í•´ë³´ì
    #í´ëŸ¬ìŠ¤í„° ë„¤íŠ¸ì›Œí¬ë¥¼ ì ‘ì†í•˜ê¸° ìœ„í•´ ëŒ€í™”í˜• íŒŒë“œë¥¼ ê¸°ë™í•œ ê²ƒì´ë‹¤.
    **kubectl run busybox --image=busybox --restart=Never --rm -it sh**
    
    #ì§€ì •ëœ urlë¡œ ë¶€í„° ì½˜í…ì¸ ë¥¼ ë‹¤ìš´ë¡œë“œ
    / # wget -q -O - http://10.244.0.33/
    <!DOCTYPE html>
    <html>
    <head>
    <title>Welcome to nginx!</title>
    <style>
    html { color-scheme: light dark; }
    body { width: 35em; margin: 0 auto;
    font-family: Tahoma, Verdana, Arial, sans-serif; }
    </style>
    </head>
    <body>
    <h1>Welcome to nginx!</h1>
    <p>If you see this page, the nginx web server is successfully installed and
    working. Further configuration is required.</p>
    
    <p>For online documentation and support please refer to
    <a href="http://nginx.org/">nginx.org</a>.<br/>
    Commercial support is available at
    <a href="http://nginx.com/">nginx.com</a>.</p>
    
    <p><em>Thank you for using nginx.</em></p>
    </body>
    </html>
    ```
    
#### (8) íŒŒë“œì˜ í—¬ìŠ¤ì²´í¬ ê¸°ëŠ¥ ğŸ¤¯
    
    **íŒŒë“œì˜ ìƒíƒœ**ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , íŒŒë“œê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥
    
    - **Liveness Probe**:
        - íŒŒë“œ ë‚´ ì»¨í…Œì´ë„ˆê°€ **ì‚´ì•„ìˆëŠ”ì§€**(ì¦‰, ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€)ë¥¼ í™•ì¸í•˜ëŠ” í—¬ìŠ¤ì²´í¬
        - ë§Œì•½ `liveness probe`ê°€ ì‹¤íŒ¨í•˜ë©´, ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” í•´ë‹¹ ì»¨í…Œì´ë„ˆë¥¼ **ì¬ì‹œì‘**í•œë‹¤.
        - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‘ë‹µí•˜ì§€ ì•Šê±°ë‚˜ ë¬´í•œ ë£¨í”„ì— ë¹ ì§„ ê²½ìš°, `liveness probe`ê°€ ì‹¤íŒ¨í•˜ê³ , ì»¨í…Œì´ë„ˆê°€ ì¬ì‹œì‘ë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤.
    - **Readiness Probe**:
        - íŒŒë“œ ë‚´ ì»¨í…Œì´ë„ˆê°€ **íŠ¸ë˜í”½ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€**(ì¦‰, ì„œë¹„ìŠ¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì œê³µí•  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€)ë¥¼ í™•ì¸í•˜ëŠ” í—¬ìŠ¤ì²´í¬
        - `readiness probe`ê°€ ì‹¤íŒ¨í•˜ë©´, íŒŒë“œëŠ” **ì„œë¹„ìŠ¤ì— íŠ¸ë˜í”½ì„ ì „ë‹¬í•˜ì§€ ì•Šë„ë¡** ì„¤ì •ëœë‹¤. ì´ë¡œ ì¸í•´ ì•„ì§ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ì„ ë•Œ ì„œë¹„ìŠ¤ì˜ íŠ¸ë˜í”½ì„ ë°›ì§€ ì•Šê²Œ ëœë‹¤.
        - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘ ì¤‘ì¼ ë•ŒëŠ” íŠ¸ë˜í”½ì„ ë°›ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆë‹¤.
    
    íŒŒë“œì—ì„œ í—¬ìŠ¤ì²´í¬ë¥¼ ì„¤ì •í•˜ë ¤ë©´ `livenessProbe`ì™€ `readinessProbe`ë¥¼ ì •ì˜ë¥¼ í•´ì¤˜ì•¼í•œë‹¤.
    
    ```yaml
    #/hc-probe/webapi-pod.yml 
    apiVersion: v1
    kind: Pod
    metadata:
      name: webapl
    spec:
      containers:
        - name: webapl
          image: maho/webapl:0.1 
          livenessProbe:
            httpGet:
              path: /healthz #/healthz ê²½ë¡œë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì¸ì§€ í™•ì¸
              #ìš”ì²­ ì‹¤íŒ¨ì‹œ ì»¨í…Œì´ë„ˆëŠ” ì¬ì‹œì‘ë¨
              port: 3000
            initialDelaySeconds: 3 #ì»¨í…Œì´ë„ˆ ì‹œì‘ í›„ ì²˜ìŒìœ¼ë¡œ í—¬ìŠ¤ì²´í¬ ì‹œë„í•˜ëŠ” ì‹œê°„
            periodSeconds: 5 # 5ì´ˆë§ˆë‹¤ ì£¼ê¸°ì ìœ¼ë¡œ í—¬ìŠ¤ì²´í¬ ì‹¤í–‰
          readinessProbe:
            httpGet:
              path: /ready #/ready ê²½ë¡œë¡œ HTTP ìš”ì²­ì„ ë³´ë‚´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ íŠ¸ë˜í”½ì„ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸
              #ì¤€ë¹„ê°€ ë˜ì§€ ì•Šìœ¼ë©´ ì„œë¹„ìŠ¤ë¡œ íŠ¸ë˜í”½ì„ ë°›ì§€ ì•Šë„ë¡ ì„¤ì •
              port: 3000
            initialDelaySeconds: 15
            periodSeconds: 6
    ```
    
    ```json
    // /hc-probe/webapl/web.js
    
    // ëª¨ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜
    const express = require('express')
    const app = express()
    var start = Date.now()
    
    // Liveness í”„ë¡œë¸Œ í•¸ë“¤ëŸ¬
    // ê¸°ëŠ¥ í›„ 40ì´ˆê°€ ë˜ë©´ 500 ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤.
    // ê·¸ ì „ê¹Œì§€ëŠ” HTTP 200 OKë¥¼ ë°˜í™˜í•œë‹¤.
    // ì¦‰, 40ì´ˆê°€ ë˜ë©´ Liveness í”„ë¡œë¸Œê°€ ì‹¤íŒ¨í•˜ì—¬ ì»¨í…Œì´ë„ˆê°€ ì¬ê¸°ë™í•œë‹¤.
    app.get('/healthz', function(request, response) {
        var msec = Date.now() - start
        var code = 200
        if (msec > 40000) {
            code = 500
        }
        console.log('GET /healthz ' + code)
        response.status(code).send('OK')
    })
    
    // Rediness í”„ë¡œë¸Œ í•¸ë“¤ëŸ¬
    // ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì´ˆê¸°í™” ì‹œê°„ìœ¼ë¡œ
    // ê¸°ëŠ¥ í›„ 20ì´ˆ ì§€ë‚˜ê³  ë‚˜ì„œë¶€í„° HTTP 200ì„ ë°˜í™˜í•œë‹¤.
    // ê·¸ ì „ê¹Œì§€ëŠ” HTTPS 200 OKë¥¼ ë°˜í™˜í•œë‹¤.
    app.get('/ready', function(request, response) {
        var msec = Date.now() - start
        var code = 500
        if (msec > 20000) {
            code = 200
        }
        console.log('GET /ready ' + code)
        response.status(code).send('OK')
    })
    
    // ì²« í™”ë©´
    app.get('/', function(request, response) {
        console.log('GET /')
        response.send('Hello from Node.js')
    })
    
    // ì„œë²„ í¬íŠ¸ ë²ˆí˜¸
    app.listen(3000);
    ```
    
    ```docker
    #/hc-probe/webapl/Dockerfile 
    #alpine linux
    FROM alpine:latest
    #node.js
    RUN apk update && apk add --no-cache nodejs npm
    
    #ì˜ì¡´ ëª¨ë“ˆ
    WORKDIR /
    ADD ./package.json /
    RUN npm install
    ADD ./webapl.js /
    
    #ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë™
    CMD node /webapl.js
    ```
    
    ```json
    #hc-probe/webapl/package.json 
    {
      "name": "webapl",
      "version": "1.0.0",
      "description": "",
      "main": "webapl.js",
      "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1"
      },
      "author": "",
      "license": "ISC",
      "dependencies": {
        "express": "^4.16.3"
      }
    }
    ```
    
    ìš°ì„  ìœ„ì™€ ê°™ì´ í•„ìš”í•œ íŒŒì¼ì„ ëª¨ë‘ ë§Œë“¤ì—ˆë‹¤.
    
    ì´í›„ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ë©´ í‘¸ì‰¬ë¥¼ í•´ì•¼í•œë‹¤. ì™œ? >
    
    `docker push`ë¥¼ **í•˜ì§€ ì•Šìœ¼ë©´** **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤!**
    
    - ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ íŒŒë“œë¥¼ ì‹¤í–‰í•˜ë ¤ë©´, í•´ë‹¹ íŒŒë“œê°€ ì‚¬ìš©í•  **Docker ì´ë¯¸ì§€**ê°€ **ë ˆì§€ìŠ¤íŠ¸ë¦¬**ì— ì¡´ì¬í•´ì•¼í•¨
    - ë¡œì»¬ì—ì„œ ë§Œë“  ì´ë¯¸ì§€ë¥¼ **`docker push`** ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ **ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— í‘¸ì‹œ**í•˜ì§€ ì•Šìœ¼ë©´, **ë¡œì»¬ ë¨¸ì‹ ì—ì„œë§Œ ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€**ëŠ” **í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—** ì‹¤í–‰í•  ìˆ˜ ì—†ìŒ
    - ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” íŒŒë“œë¥¼ ìƒì„±í•  ë•Œ **ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì´ë¯¸ì§€ë¥¼ pull**í•˜ì—¬ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸!
    
    ```bash
    
    #Dockerfileë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³ 
    docker build --tag maho/webapl:0.1 .
    #ë‚´ ë„ì»¤ ë ˆí¬ì§€í† ë¦¬ì— pushí–ˆë‹¤.
    docker tag maho/webapl:0.1 mushr00mandu/webapl:0.1
    docker push mushr00mandu/webapl:0.1
    #ë¡œê·¸ì¸í•œë‹¤
    docker login
    
    **kubectl apply -f webapi-pod.yml #yml íŒŒì¼ë¡œ podë¥¼ ë§Œë“ ë‹¤**
    
    **kubectl get pods #ì•„ì§ íŠ¸ë˜í”½ì„ ë°›ì„ ì¤€ë¹„ë¥¼ í•˜ê³  ìˆëŠ” webapl**
    NAME          READY   STATUS             RESTARTS   AGE
    hello-world   0/1     Completed          0          128m
    webapl        0/1     Running            0          18s
    
    **kubectl logs webapl**
    GET /healthz 200 #ìƒíƒœê°€ ì •ìƒ(200ok)
    GET /healthz 200
    GET /healthz 200
    GET /ready 500 #ì•„ì§ ì„œë²„ê°€ ì¤€ë¹„ë˜ì§€ ì•ŠìŒ(500 Internal Server Error) 
    GET /healthz 200
    GET /ready 500
    GET /healthz 200
    GET /ready 200  #ì„œë²„ê°€ ì¤€ë¹„ë˜ì—ˆë‹¤.
    
    **kubectl describe pod webapl**
    #í—¬ìŠ¤ì²´í¬ ê´€ë ¨ ìƒíƒœ í™•ì¸
        Liveness:       http-get http://:3000/healthz delay=3s timeout=1s period=5s #success=1 #failure=3
        Readiness:      http-get http://:3000/ready delay=15s timeout=1s period=6s #success=1 #failure=3
    #í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ë¡œ ì¸í•œ ìƒíƒœë“¤ë„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
    Events:
      Type     Reason     Age                From               Message
      ----     ------     ----               ----               -------
      Normal   Scheduled  66s                default-scheduler  Successfully assigned default/webapl to minikube
      Normal   Pulling    65s                kubelet            Pulling image "maho/webapl:0.1"
      Normal   Pulled     58s                kubelet            Successfully pulled image "maho/webapl:0.1" in 6.892s (6.892s including waiting). Image size: 51079110 bytes.
      Normal   Created    58s                kubelet            Created container: webapl
      Normal   Started    57s                kubelet            Started container webapl
      Warning  Unhealthy  37s (x2 over 43s)  kubelet            **Readiness probe failed: HTTP probe failed with statuscode: 500**
      Warning  Unhealthy  5s (x3 over 15s)   kubelet            **Liveness probe failed: HTTP probe failed with statuscode: 500**
      Normal   Killing    5s                 kubelet            **Container webapl failed liveness probe, will be restarted**
      
    **kubectl get pods**
    NAME          READY   STATUS      RESTARTS   AGE
    hello-world   0/1     Completed   0          129m
    webapl        1/1     Running     0          88s **#íŠ¸ë˜í”½ ë°›ì„ ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤!**
    ```
    
    í”„ë¡œë¸ŒëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ê¸°ëŠ¥ ì•„ë‹Œê°€? ì™œ `Node.js`ë¡œ ë”°ë¡œ êµ¬í˜„í•œ ê²ƒì¼ê¹Œ?
    
    - **Liveness**ì™€ **Readiness** í”„ë¡œë¸ŒëŠ” **íŠ¹ì • ê²½ë¡œ**(ì˜ˆ: `/healthz`, `/ready`)ì— ëŒ€í•´ **HTTP GET ìš”ì²­**ì„ ë³´ë‚´ê²Œ ëœë‹¤. ë”°ë¼ì„œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ëŸ¬í•œ ê²½ë¡œë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” **HTTP ì„œë²„**ê°€ í•„ìš”í•˜ë‹¤.
    - **Node.js**ëŠ” ë¹ ë¥´ê³  ê°„ë‹¨í•˜ê²Œ HTTP ì„œë²„ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” **ì›¹ í”„ë ˆì„ì›Œí¬ì¸ Express.js**ë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì—, **í—¬ìŠ¤ì²´í¬**ë¥¼ ìœ„í•œ ê²½ë¡œë¥¼ êµ¬í˜„í•˜ëŠ” ë° ì í•©í•˜ë‹¤.
#### (9) initContainer
    
    ### **`initContainer`ë€?**
    
    - `initContainer`ëŠ” íŒŒë“œ ë‚´ì—ì„œ **ì£¼ìš” ì‘ì—…ì„ ì‹œì‘í•˜ê¸° ì „ì— ì´ˆê¸°í™”**ë¥¼ ë‹´ë‹¹í•˜ëŠ” **íŠ¹ë³„í•œ ì»¨í…Œì´ë„ˆ**ì•¼. ì´ ì»¨í…Œì´ë„ˆëŠ” **ë©”ì¸ ì»¨í…Œì´ë„ˆ**ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë¨¼ì € ì‹¤í–‰ëœë‹¤.
    - `initContainer`ëŠ” ì£¼ë¡œ **íŒŒì¼ì„ ì¤€ë¹„í•˜ê±°ë‚˜ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±**í•˜ëŠ” ë“±ì˜ **ì´ˆê¸° ì„¤ì •**ì„ ìˆ˜í–‰í•œë‹¤.
    
    ### `initContainer`ì˜ ë™ì‘ ë°©ì‹:
    
    1. `initContainer`ëŠ” íŒŒë“œê°€ ì‹œì‘ë  ë•Œ **ì²« ë²ˆì§¸ë¡œ ì‹¤í–‰ëœë‹¤.**
    2. ì´ˆê¸°í™” ì‘ì—…ì´ ëª¨ë‘ ëë‚˜ë©´ `initContainer`ëŠ” ì¢…ë£Œë˜ê³ , **ë©”ì¸ ì»¨í…Œì´ë„ˆ**ê°€ ê·¸ ì´í›„ì— ì‹¤í–‰ëœë‹¤.
    3. `initContainer`ëŠ” **í•œ ë²ˆë§Œ ì‹¤í–‰**ë˜ë©°, ë©”ì¸ ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ í•„ìš”í•œ ì„¤ì •(ì˜ˆ: íŒŒì¼ ì¤€ë¹„, ë””ë ‰í† ë¦¬ ìƒì„± ë“±)ì„ ë§ˆì¹œ í›„ ì¢…ë£Œëœë‹¤.
    
    ```bash
    #init-sample.yml
    apiVersion: v1
    kind: Pod
    metadata:
      name: init-sample
    spec:
      containers:
        - name: main # ë©”ì¸ ì»¨í…Œì´ë„ˆ
          image: ubuntu
          command: ["/bin/sh"]
          args: ["-c", "tail -f /dev/null"]
          volumeMounts:
            - mountPath: /docs # ê³µìœ  ë³¼ë¥¨ ë§ˆìš´íŠ¸ ê²½ë¡œ
              name: data-vol
              readOnly: false
    
      initContainers: # ë©”ì¸ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì „ì— ì´ˆê¸°í™” ì „ìš© ì»¨í…Œì´ë„ˆë¥¼ ê¸°ë™
        - name: init
          image: alpine
          # ê³µìœ  ë³¼ë¥¨ì— ë””ë ‰í„°ë¦¬ë¥¼ ì‘ì„±í•˜ê³ , ì†Œìœ ë¥¼ ë³€ê²½
          command: ["/bin/sh"]
          args: ["-c", "mkdir /mnt/html; chown 33:33 /mnt/html"]
          volumeMounts:
            - mountPath: /mnt # ê³µìœ  ë³¼ë¥¨ ë§ˆìš´íŠ¸ ê²½ë¡œ
              name: data-vol
              readOnly: false
    
      volumes: # íŒŒë“œì˜ ê³µìœ  ë³¼ë¥¨
        - name: data-vol
          emptyDir: {}
    ```
    
    ```bash
    kubectl apply -f init-sample.yml
    **kubectl exec -it init-sample -c main -- sh**
    # ls -al /docs/
    total 12
    drwxrwxrwx 3 root     root     4096 Feb 18 11:33 .
    drwxr-xr-x 1 root     root     4096 Feb 18 11:33 ..
    drwxr-xr-x 2 www-data www-data 4096 Feb 18 11:33 html
    ```
    
#### (10) ì‚¬ì´ë“œì¹´ íŒ¨í„´
    - í•˜ë‚˜ì˜ íŒŒë“œ ì•ˆì— ì—¬ëŸ¬ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ë‹´ì•„, ë™ì‹œì— ì‹¤í–‰í•˜ëŠ” íŒ¨í„´
    - ì›¹ ì„œë²„ ì»¨í…Œì´ë„ˆ(ì˜ˆ:nginx) + ìµœì‹  ì½˜í…ì¸ ë¥¼ ê¹ƒí—™ì—ì„œ ë‹¤ìš´ë°›ëŠ” ì»¨í…Œì´ë„ˆ(ì •ê¸°ì ìœ¼ë¡œ pullí•´ì„œ ì½˜í…ì¸ ë¥¼ ìµœì‹ ìœ¼ë¡œ ìœ ì§€í•œë‹¤.) â†’ ì‚¬ì´ë“œì¹´ íŒ¨í„´ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.
    - ì–´í”Œë¦¬ì¼€ì´ì…˜ ë³€ê²½ ì—†ì´ ì‚¬ì´ë“œì¹´ë¥¼ ë¶™ì˜€ë‹¤ ë–¼ê±°ë‚˜ êµì²´í•˜ê¸° ì‰¬ìš´ êµ¬ì„± ë°©ì‹ì´ë‹¤.
    - ë‘˜ë‹¤ ê°™ì€ ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ ë¦¬ì†ŒìŠ¤ë¥¼ ì ì ˆíˆ ì„¤ì •í•´ì•¼í•œë‹¤.
    - ì˜ì¡´ì„± ê´€ë¦¬ê°€ í•„ìš”í•˜ë©°, ì‚¬ì´ë“œì¹´ëŠ” ë©”ì¸ ì»¨í…Œì´ë„ˆë³´ë‹¤ ë‚˜ì¤‘ì— ì‹œì‘í•˜ê³  ë‚˜ì¤‘ì— ì¢…ë£Œí•´ì•¼í•¨.
    
    ```bash
    #nginx-sidecar.yml
    
    apiVersion: v1
    kind: Pod
    metadata:
      name: nginx-busybox-pod
    spec:
      containers:
        - name: nginx # ë©”ì¸ ì»¨í…Œì´ë„ˆ
          image: nginx:latest
          volumeMounts:
            - mountPath: /var/log/nginx
              name: log-volume
    
        - name: busybox # nginxì— 10ì´ˆ ê°„ê²©ìœ¼ë¡œ wget ìš”ì²­ì„ ë³´ëƒ„
          image: busybox:latest
          command: ["/bin/sh", "-c", "while true; do wget -qO- http://localhost:80; sleep 10; done"]
          volumeMounts:
            - mountPath: /var/log/nginx
              name: log-volume
    
        - name: log-checker # log-volumeì„ ê³µìœ í•˜ë©° ì§€ì†ì ìœ¼ë¡œ ë¡œê·¸ë¥¼ í™•ì¸í•¨
          image: busybox:latest
          command: ["/bin/sh", "-c", "tail -f /var/log/nginx/access.log"]
          volumeMounts:
            - mountPath: /var/log/nginx
              name: log-volume
    
      volumes:
        - name: log-volume
          emptyDir: {}
    
    ```
    
    ```bash
    kubectl apply -f nginx-sidecar.yml
    kubectl get pods
    NAME                READY   STATUS      RESTARTS   AGE
    nginx-busybox-pod   3/3     Running     0          16s
    kubectl delete pods init-sample
    
    **kubectl logs -f nginx-busybox-pod -c log-checker #-c ë’¤ëŠ” ì»¨í…Œì´ë„ˆ ì´ë¦„ì„
    #ì—´ì‹¬íˆ wget ìš”ì²­ì„ ë³´ë‚´ê³  ìˆëŠ” ë¡œê·¸ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.**
    127.0.0.1 - - [18/Feb/2025:12:27:25 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:27:36 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:27:46 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:27:56 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:06 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:16 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:26 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:36 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:46 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    127.0.0.1 - - [18/Feb/2025:12:28:56 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"
    ```
    
#### (11) ë¦¬í”Œë¦¬ì¹´ì…‹
    
    ```bash
    # myreplicaset.yaml
    apiVersion: apps/v1
    kind: ReplicaSet
    metadata:
      name: myreplicaset
    spec:
      replicas: 2
      selector:#ReplicaSetì´ ê´€ë¦¬í•  Podë“¤ì„ ì„ íƒí•˜ëŠ” ì¡°ê±´ì„ ì„¤ì •
        matchLabels: #podì˜ íŠ¹ì • labelsê°€ íŠ¹ì • ê°’ì„ ê°–ëŠ”ì§€ë¥¼ í™•ì¸í•¨
          run: nginx-rs
      template:
        metadata:
          labels:
            run: nginx-rs #ì´ë ‡ê²Œí•˜ë©´ ë ˆí”Œë¦¬ì¹´ì…‹ì— ì˜í•´ ìƒì„±ëœ podë“¤ì€ ëª¨ë‘ ì´ ë¼ë²¨ì„ ê°–ê²Œë¨(=ê´€ë¦¬ê°€ëŠ¥)
        spec:
          containers:
            - name: nginx
              image: nginx
    ```
    
    ```bash
    kubectl apply -f myreplicaset.yaml
    
    #replicasetì˜ í˜„ì¬ ìƒíƒœë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.
    **kubectl get replicaset**
    NAME           DESIRED   CURRENT   READY   AGE
    myreplicaset   2         2         2       17s
    
    kubectl get pod
    NAME                 READY   STATUS      RESTARTS   AGE
    hello-world          0/1     Completed   0          7h31m
    myreplicaset-9tcmt   1/1     Running     0          23s
    myreplicaset-qmtw2   1/1     Running     0          23s
    
    #ë³µì œë³¸ ê°œìˆ˜ë¥¼ í™•ì¥(replica scaling)í•´ë³´ì
    **kubectl scale rs --replicas 4 myreplicaset**
    replicaset.apps/myreplicaset scaled
    
    #4ê°œë¡œ ëŠ˜ì–´ë‚¬ë‹¤!
    **kubectl get rs**
    NAME           DESIRED   CURRENT   READY   AGE
    myreplicaset   4         4         4       62s
    
    **kubectl get pod**
    NAME                 READY   STATUS      RESTARTS   AGE
    hello-world          0/1     Completed   0          7h32m
    myreplicaset-9tcmt   1/1     Running     0          65s
    myreplicaset-qmtw2   1/1     Running     0          65s
    myreplicaset-wxmmf   1/1     Running     0          14s
    myreplicaset-xwfc4   1/1     Running     0          14s
    
    #ë ˆí”Œë¦¬ì¹´ì…‹ì´ ë„¤ê°œê°€ ë˜ë„ë¡ ê´€ë¦¬ì¤‘ì´ê¸° ë•Œë¬¸ì—, í•˜ë‚˜ë¥¼ ì§€ì›Œë„ ê·¸ ìë¦¬ì— ìƒˆ podì´ ì˜¬ë¼ì˜¨ë‹¤.
    kubectl delete pod myreplicaset-9tcmt
    kubectl get pod
    NAME                 READY   STATUS              RESTARTS   AGE
    hello-world          0/1     Completed           0          7h34m
    myreplicaset-qmtw2   1/1     Running             0          3m28s
    **myreplicaset-vn7km   0/1     ContainerCreating   0          2s**
    myreplicaset-wxmmf   1/1     Running             0          2m37s
    myreplicaset-xwfc4   1/1     Running             0          2m37s
    
    #ëª¨ë‘ ì§€ìš°ëŠ” ëª…ë ¹ì–´
    **kubectl delete rs --all**
    ```
    
#### (12) ë””í”Œë¡œì´ë¨¼íŠ¸
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ì—…ë°ì´íŠ¸ ë° ë°°í¬ë¥¼ ìœ„í•œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ, ë¦¬í”Œë¦¬ì¹´ì…‹ì„ ê´€ë¦¬í•œë‹¤.
    - labelê³¼ selectorë¥¼ í†µí•´ pod ê°ì²´ë¥¼ í™•ì¸í•œë‹¤.
    
    ```bash
    # mydeploy.yaml
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mydeploy
    spec:
      replicas: 10
      selector:
        matchLabels:
          run: nginx
      strategy:
      #ë§Œì•½ ì¬ìƒì„± ì „ëµì´ë¼ë©´ type: Recreateë¥¼ ì“°ë©´ ëœë‹¤.
        type: RollingUpdate
        rollingUpdate:
          maxUnavailable: 25%
          maxSurge: 25%
      template:
        metadata:
          labels:
            run: nginx
        spec:
          containers:
            - name: nginx
              image: nginx:1.7.9
    ```
    
    ```bash
    kubectl apply --record -f mydeploy.yaml
    #recordë¥¼ ì‚¬ìš©í•˜ë©´ kubectl ëª…ë ¹ì–´ë¥¼ í†µí•´ Kubernetes ë¦¬ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•  ë•Œë§ˆë‹¤ 
    #ëª…ë ¹ì–´ì˜ ì´ë ¥ì´ Kubernetesì˜ annotationì— ê¸°ë¡ë¨
    #ë³€ê²½ê¸°ë¡ì„ ì¶”ì í•˜ê³ , kubectl rollout historyë¥¼ í†µí•´ ë¡¤ë°±ì„ í•  ìˆ˜ ìˆìŒ.
    
    **kubectl get deployment**
    NAME       READY   UP-TO-DATE   AVAILABLE   AGE
    mydeploy   0/10    10           0           12s #nginx ë²„ì „ì´ 1.7.9ì˜€ëŠ”ë° ì–´ì§¸ì„œì¸ì§€ pullì´ ì•ˆë¨.
    kubectl get rs
    NAME                  DESIRED   CURRENT   READY   AGE
    mydeploy-7f75dd868b   10        10        0       19s
    
    #ë‹¹ì—°íˆ podë“¤ë„ ì œëŒ€ë¡œ ë§Œë“¤ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤
    kubectl get pod
    NAME                        READY   STATUS              RESTARTS   AGE
    hello-world                 0/1     Completed           0          7h55m
    mydeploy-7f75dd868b-7784f   0/1     ErrImagePull        0          28s
    mydeploy-7f75dd868b-fj6fz   0/1     ErrImagePull        0          28s
    mydeploy-7f75dd868b-hdvzq   0/1     ErrImagePull        0          28s
    mydeploy-7f75dd868b-jt9gh   0/1     ImagePullBackOff    0          28s
    mydeploy-7f75dd868b-pgj65   0/1     ContainerCreating   0          28s
    mydeploy-7f75dd868b-qddd4   0/1     ErrImagePull        0          28s
    mydeploy-7f75dd868b-r728q   0/1     ImagePullBackOff    0          28s
    mydeploy-7f75dd868b-sckxc   0/1     ErrImagePull        0          28s
    mydeploy-7f75dd868b-wv72r   0/1     ImagePullBackOff    0          28s
    mydeploy-7f75dd868b-zc4f6   0/1     ErrImagePull        0          28s
    
    #ë²„ì „ì„ ë°”ê¿”ì£¼ë‹ˆ ì˜ ëŒì•„ê°„ë‹¤.
    **kubectl set image deployment mydeploy nginx=nginx:latest --**
    kubectl get pod
    
    NAME                        READY   STATUS      RESTARTS   AGE
    hello-world                 0/1     Completed   0          7h56m
    mydeploy-5446bfdff6-d66bl   1/1     Running     0          20s
    mydeploy-5446bfdff6-gjkh8   1/1     Running     0          15s
    mydeploy-5446bfdff6-nfzvl   1/1     Running     0          16s
    mydeploy-5446bfdff6-qzpqh   1/1     Running     0          27s
    mydeploy-5446bfdff6-s7b28   1/1     Running     0          27s
    mydeploy-5446bfdff6-svnhd   1/1     Running     0          26s
    mydeploy-5446bfdff6-txm64   1/1     Running     0          27s
    mydeploy-5446bfdff6-w4nd4   1/1     Running     0          17s
    mydeploy-5446bfdff6-wq6dp   1/1     Running     0          17s
    mydeploy-5446bfdff6-zl9bk   1/1     Running     0          27s
    
    #ë³€ê²½ ì´ë ¥ë„ ë³¼ ìˆ˜ ìˆë‹¤. 
    kubectl rollout status deployment mydeploy
    deployment "mydeploy" successfully rolled out
    
    #pod í•˜ë‚˜ë¥¼ ì‚´í´ë³´ë©´, image ë²„ì „ì´ ì˜ ë°”ë€ ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    **kubectl get pod mydeploy-5446bfdff6-d66bl -o yaml | grep "image: nginx"**
      - image: nginx:latest
        image: nginx:latest
    
    #ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë²„ì „ì˜ ì´ë¯¸ì§€ë¡œ ì„¸íŒ…í•˜ë©´ ì²œì²œíˆ ì—ëŸ¬ë‚˜ëŠ” ê²ƒìœ¼ë¡œ rolloutëœë‹¤.
    **kubectl set image deployment mydeploy nginx=nginx:1.9.21 --record
    kubectl rollout status deployment mydeploy**
    Waiting for deployment "mydeploy" rollout to finish: 5 out of 10 new replicas have been updated...
    ^C(ë©ˆì¶¤)
    kubectl get pod
    NAME                        READY   STATUS              RESTARTS   AGE
    hello-world                 0/1     Completed           0          7h58m
    mydeploy-5446bfdff6-gjkh8   1/1     Running             0          2m13s
    mydeploy-5446bfdff6-nfzvl   1/1     Running             0          2m14s
    mydeploy-5446bfdff6-qzpqh   1/1     Running             0          2m25s
    mydeploy-5446bfdff6-s7b28   1/1     Running             0          2m25s
    mydeploy-5446bfdff6-svnhd   1/1     Running             0          2m24s
    mydeploy-5446bfdff6-txm64   1/1     Running             0          2m25s
    mydeploy-5446bfdff6-wq6dp   1/1     Running             0          2m15s
    mydeploy-5446bfdff6-zl9bk   1/1     Running             0          2m25s
    mydeploy-6c488cb88b-f8qg9   0/1     ErrImagePull        0          13s
    mydeploy-6c488cb88b-msslr   0/1     ErrImagePull        0          13s
    mydeploy-6c488cb88b-n5xcz   0/1     ErrImagePull        0          13s
    mydeploy-6c488cb88b-v7m7l   0/1     ErrImagePull        0          13s
    mydeploy-6c488cb88b-zfzb9   0/1     ContainerCreating   0          13s
    
    #íˆìŠ¤í† ë¦¬ë¥¼ í™•ì¸í•´ rolloutì„ ì œê±°í•  ìˆ˜ ìˆë‹¤. 
    **kubectl rollout history deployment mydeploy**
    deployment.apps/mydeploy 
    REVISION  CHANGE-CAUSE
    1         kubectl apply --cluster=minikube --record=true --filename=mydeploy.yaml
    2         kubectl apply --cluster=minikube --record=true --filename=mydeploy.yaml
    3         kubectl set image deployment mydeploy nginx=nginx:1.9.21 --cluster=minikube --record=true
    **kubectl rollout undo deployment mydeploy**
    
    #ë‹¤ì‹œ í™•ì¸í•´ë³´ë©´ ì•„ê¹Œì „ìœ¼ë¡œ ëŒì•„ì™”ë‹¤.
    **kubectl get deployment mydeploy -o yaml | grep image**
     {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{"kubernetes.io/change-cause":"kubectl apply --cluster=minikube --record=true --filename=mydeploy.yaml"},"name":"mydeploy","namespace":"default"},"spec":{"replicas":10,"selector":{"matchLabels":{"run":"nginx"}},"strategy":{"rollingUpdate":{"maxSurge":"25%","maxUnavailable":"25%"},"type":"RollingUpdate"},"template":{"metadata":{"labels":{"run":"nginx"}},"spec":{"containers":[{"image":"nginx:1.7.9","name":"nginx"}]}}}}
          - image: nginx:latest
            imagePullPolicy: IfNotPresent
            
    #ë²„ì „ì„ ì§€ì •í•´ì„œ ë˜ëŒë¦¬ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.
    **kubectl rollout undo deploy mydeploy --to-revision=1 
    
    #ìŠ¤ì¼€ì¼ ì¡°ì •ë„ ê°€ëŠ¥í•˜ë‹¤.
    #ì²œì²œíˆ ì¤„ê³  ìˆëŠ” ëª¨ìŠµì„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.**
    **kubectl scale deployment --replicas 5 mydeploy**
    kubectl get pod
    NAME                        READY   STATUS             RESTARTS   AGE
    hello-world                 0/1     Completed          0          8h
    mydeploy-5446bfdff6-gjkh8   1/1     Running            0          9m49s
    mydeploy-5446bfdff6-nfzvl   1/1     Running            0          9m50s
    mydeploy-5446bfdff6-qzpqh   1/1     Running            0          10m
    mydeploy-5446bfdff6-svnhd   1/1     Running            0          10m
    mydeploy-7f75dd868b-9kpb4   0/1     ErrImagePull       0          69s
    mydeploy-7f75dd868b-dzmcp   0/1     ErrImagePull       0          69s
    mydeploy-7f75dd868b-pjthb   0/1     ImagePullBackOff   0          69s
    
    #ë‹¤ì‹œ ë˜ëŒë¦°ë‹¤! (ì´ë¯¸ì§€ ì˜¤ë¥˜ë¡œ ì¸í•´ rolloutê³¼ scalingì´ ì•ˆë˜ëŠ” ê²ƒ ê°™ì•„ **latestë¡œ êµì²´í•¨)
    kubectl scale deployment mydeploy --replicas=10**
    kubectl get pod
    NAME                        READY   STATUS              RESTARTS   AGE
    hello-world                 0/1     Completed           0          8h
    mydeploy-5446bfdff6-gjkh8   1/1     Running             0          15m
    mydeploy-5446bfdff6-lntsz   1/1     Running             0          43s
    mydeploy-5446bfdff6-nfzvl   1/1     Running             0          15m
    mydeploy-5446bfdff6-pscbg   0/1     ContainerCreating   0          5s
    mydeploy-5446bfdff6-qqv4t   0/1     ContainerCreating   0          5s
    mydeploy-5446bfdff6-qzpqh   1/1     Running             0          15m
    mydeploy-5446bfdff6-rcjvq   0/1     ContainerCreating   0          5s
    mydeploy-5446bfdff6-rx4f8   0/1     ContainerCreating   0          5ss
    mydeploy-5446bfdff6-svnhd   1/1     Running             0          15m
    mydeploy-5446bfdff6-zm79j   0/1     ContainerCreating   0          5s
    
    #ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ replicas í•­ëª©ì„ 3ìœ¼ë¡œ ìˆ˜ì •í•´ë³¸ë‹¤(í•˜ë‹¨ ì‚¬ì§„)
    **kubectl edit deploy mydeploy**
    
    #3ê°œë¡œ ì¤„ì–´ìˆëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.
    kubectl get pod
    NAME                        READY   STATUS      RESTARTS   AGE
    hello-world                 0/1     Completed   0          8h
    mydeploy-5446bfdff6-gjkh8   1/1     Running     0          23m
    mydeploy-5446bfdff6-nfzvl   1/1     Running     0          23m
    mydeploy-5446bfdff6-qzpqh   1/1     Running     0          24m
    
    #ì •ë¦¬í•˜ê¸°
    **kubectl delete deploy --all**
    ```
    

 <img src="img/65.png">



### ì˜¤ëŠ˜ì˜ íšŒê³ 
- ì¿ ë²„ë„¤í‹°ìŠ¤ ê°œë…ì„ ë³µìŠµí•˜ë©° ì²œì²œíˆ ì‹¤ìŠµì„ ì§„í–‰í–ˆë‹¤. ì—­ì‹œ ì§ì ‘ ì§„í–‰í•´ë³´ë‹ˆ ì´í•´ê°€ í›¨ì”¬ ì˜ë˜ëŠ” ê²ƒ ê°™ë‹¤. íŠ¹íˆ health checkì—ì„œ ì´ë¡ ì„ ì˜ ì´í•´í•˜ì§€ ëª»í•˜ê³  ì‹¤ìŠµì„ ì‹œì‘í•˜ë‹ˆ ì–´ë ¤ì›€ì„ ë§ì´ ê²ªì–´ì„œ ê·¸ë§Œí¼ ë§ì´ ì°¾ì•„ë´¤ëŠ”ë°, í”„ë¡œë¸Œë¥¼ ë§Œë“œëŠ” ì´ìœ ê°€ ê°€ì¥ í—·ê°ˆë ¸ë˜ ê²ƒ ê°™ë‹¤. ê°œë…ì„ ê³µë¶€í•˜ë‹ˆ êµ¬ì¡°ë„ ì¡°ê¸ˆ ì´í•´í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
  
### ì°¸ê³  ìë£Œ ë° ë§í¬
- x